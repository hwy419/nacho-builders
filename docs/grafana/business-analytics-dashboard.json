{
  "dashboard": {
    "title": "Cardano API - Business Analytics",
    "tags": ["cardano", "api", "business", "revenue"],
    "timezone": "browser",
    "schemaVersion": 38,
    "version": 1,
    "refresh": "1m",
    "panels": [
      {
        "title": "Total Revenue (MTD)",
        "type": "stat",
        "gridPos": { "x": 0, "y": 0, "w": 8, "h": 6 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT SUM(amount / 1000000.0) as ada_revenue FROM payments WHERE status = 'CONFIRMED' AND DATE_TRUNC('month', confirmed_at) = DATE_TRUNC('month', NOW())",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ADA",
            "decimals": 2
          }
        }
      },
      {
        "title": "Total Users",
        "type": "stat",
        "gridPos": { "x": 8, "y": 0, "w": 8, "h": 6 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT COUNT(*) as total FROM users WHERE status = 'ACTIVE'",
            "format": "table"
          }
        ]
      },
      {
        "title": "Credits Sold (MTD)",
        "type": "stat",
        "gridPos": { "x": 16, "y": 0, "w": 8, "h": 6 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT SUM(credits) as total FROM payments WHERE status = 'CONFIRMED' AND DATE_TRUNC('month', confirmed_at) = DATE_TRUNC('month', NOW())",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "decimals": 0
          }
        }
      },
      {
        "title": "Revenue Trend (30 Days)",
        "type": "timeseries",
        "gridPos": { "x": 0, "y": 6, "w": 16, "h": 8 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT DATE(confirmed_at) as time, SUM(amount / 1000000.0) as revenue FROM payments WHERE status = 'CONFIRMED' AND confirmed_at >= NOW() - INTERVAL '30 days' GROUP BY DATE(confirmed_at) ORDER BY time",
            "format": "time_series"
          }
        ]
      },
      {
        "title": "Tier Distribution",
        "type": "piechart",
        "gridPos": { "x": 16, "y": 6, "w": 8, "h": 8 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT CASE WHEN tier = 'FREE' THEN 'Free' ELSE 'Paid' END as tier, COUNT(DISTINCT user_id) as users FROM api_keys WHERE active = true GROUP BY tier",
            "format": "table"
          }
        ]
      },
      {
        "title": "User Growth (30 Days)",
        "type": "timeseries",
        "gridPos": { "x": 0, "y": 14, "w": 12, "h": 8 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT DATE(created_at) as time, COUNT(*) as signups FROM users WHERE created_at >= NOW() - INTERVAL '30 days' GROUP BY DATE(created_at) ORDER BY time",
            "format": "time_series"
          }
        ]
      },
      {
        "title": "Top 10 Users by API Calls",
        "type": "table",
        "gridPos": { "x": 12, "y": 14, "w": 12, "h": 8 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT u.email, ak.tier, COUNT(ul.id) as api_calls, SUM(ul.credits_used) as credits_used FROM usage_logs ul JOIN api_keys ak ON ul.api_key_id = ak.id JOIN users u ON ul.user_id = u.id WHERE ul.timestamp >= NOW() - INTERVAL '7 days' GROUP BY u.email, ak.tier ORDER BY api_calls DESC LIMIT 10",
            "format": "table"
          }
        ]
      },
      {
        "title": "Payment Success Rate",
        "type": "gauge",
        "gridPos": { "x": 0, "y": 22, "w": 8, "h": 6 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT COUNT(*) FILTER (WHERE status = 'CONFIRMED') * 100.0 / NULLIF(COUNT(*), 0) as success_rate FROM payments WHERE created_at >= NOW() - INTERVAL '7 days'",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "max": 100
          }
        }
      },
      {
        "title": "Credit Economics",
        "type": "timeseries",
        "gridPos": { "x": 8, "y": 22, "w": 16, "h": 6 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT DATE(created_at) as time, SUM(credits) as purchased FROM payments WHERE status = 'CONFIRMED' GROUP BY DATE(created_at) ORDER BY time",
            "legendFormat": "Credits Purchased"
          },
          {
            "rawSql": "SELECT DATE(timestamp) as time, SUM(credits_used) as consumed FROM usage_logs GROUP BY DATE(timestamp) ORDER BY time",
            "legendFormat": "Credits Consumed"
          }
        ]
      },
      {
        "title": "GraphQL Analytics",
        "type": "row",
        "gridPos": { "x": 0, "y": 28, "w": 24, "h": 1 },
        "collapsed": false
      },
      {
        "title": "GraphQL Usage by Tier",
        "type": "piechart",
        "gridPos": { "x": 0, "y": 29, "w": 8, "h": 8 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT ak.tier, COUNT(*) as requests FROM \"UsageLog\" ul JOIN \"ApiKey\" ak ON ul.\"apiKeyId\" = ak.id WHERE ul.endpoint LIKE '%graphql%' AND ul.timestamp >= NOW() - INTERVAL '7 days' GROUP BY ak.tier",
            "format": "table"
          }
        ]
      },
      {
        "title": "GraphQL Adoption Rate",
        "type": "stat",
        "gridPos": { "x": 8, "y": 29, "w": 8, "h": 4 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT COUNT(DISTINCT ul.\"userId\") * 100.0 / NULLIF((SELECT COUNT(DISTINCT id) FROM \"User\"), 0) as adoption_rate FROM \"UsageLog\" ul WHERE ul.endpoint LIKE '%graphql%' AND ul.timestamp >= NOW() - INTERVAL '30 days'",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "decimals": 1
          }
        }
      },
      {
        "title": "GraphQL Credits Consumed (7d)",
        "type": "stat",
        "gridPos": { "x": 16, "y": 29, "w": 8, "h": 4 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT COALESCE(SUM(\"creditsUsed\"), 0) as credits FROM \"UsageLog\" WHERE endpoint LIKE '%graphql%' AND timestamp >= NOW() - INTERVAL '7 days'",
            "format": "table"
          }
        ]
      },
      {
        "title": "GraphQL Requests by Network",
        "type": "timeseries",
        "gridPos": { "x": 8, "y": 33, "w": 16, "h": 8 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT DATE(timestamp) as time, COUNT(*) as requests FROM \"UsageLog\" WHERE endpoint = 'v1/graphql' AND timestamp >= NOW() - INTERVAL '7 days' GROUP BY DATE(timestamp) ORDER BY time",
            "legendFormat": "Mainnet"
          },
          {
            "rawSql": "SELECT DATE(timestamp) as time, COUNT(*) as requests FROM \"UsageLog\" WHERE endpoint = 'v1/preprod/graphql' AND timestamp >= NOW() - INTERVAL '7 days' GROUP BY DATE(timestamp) ORDER BY time",
            "legendFormat": "Preprod"
          }
        ]
      },
      {
        "title": "API Endpoint Distribution",
        "type": "piechart",
        "gridPos": { "x": 0, "y": 37, "w": 8, "h": 8 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT CASE WHEN endpoint LIKE '%graphql%' THEN 'GraphQL' WHEN endpoint LIKE '%ogmios%' THEN 'Ogmios' WHEN endpoint LIKE '%submit%' THEN 'Submit API' ELSE 'Other' END as endpoint_type, COUNT(*) as requests FROM \"UsageLog\" WHERE timestamp >= NOW() - INTERVAL '7 days' GROUP BY endpoint_type",
            "format": "table"
          }
        ]
      },
      {
        "title": "Top GraphQL Users",
        "type": "table",
        "gridPos": { "x": 8, "y": 41, "w": 16, "h": 6 },
        "datasource": "API-PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT u.email, ak.tier, COUNT(ul.id) as graphql_calls, SUM(ul.\"creditsUsed\") as credits_used FROM \"UsageLog\" ul JOIN \"ApiKey\" ak ON ul.\"apiKeyId\" = ak.id JOIN \"User\" u ON ul.\"userId\" = u.id WHERE ul.endpoint LIKE '%graphql%' AND ul.timestamp >= NOW() - INTERVAL '7 days' GROUP BY u.email, ak.tier ORDER BY graphql_calls DESC LIMIT 10",
            "format": "table"
          }
        ]
      }
    ]
  }
}






