{
  "dashboard": {
    "title": "Cardano API - Technical Operations",
    "tags": ["cardano", "api", "technical"],
    "timezone": "browser",
    "schemaVersion": 38,
    "version": 1,
    "refresh": "5s",
    "panels": [
      {
        "title": "API Health Status",
        "type": "stat",
        "gridPos": { "x": 0, "y": 0, "w": 24, "h": 4 },
        "targets": [
          {
            "expr": "up{job=\"kong\"}",
            "legendFormat": "Kong Gateway"
          },
          {
            "expr": "up{job=\"gateway-node\"}",
            "legendFormat": "Gateway VM"
          },
          {
            "expr": "up{job=\"dbsync-node\"}",
            "legendFormat": "DB-Sync VM"
          }
        ],
        "options": {
          "graphMode": "none",
          "colorMode": "background",
          "orientation": "horizontal"
        },
        "fieldConfig": {
          "defaults": {
            "mappings": [
              { "options": { "0": { "text": "DOWN", "color": "red" } } },
              { "options": { "1": { "text": "UP", "color": "green" } } }
            ],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "value": 0, "color": "red" },
                { "value": 1, "color": "green" }
              ]
            }
          }
        }
      },
      {
        "title": "Requests per Second",
        "type": "timeseries",
        "gridPos": { "x": 0, "y": 4, "w": 12, "h": 8 },
        "targets": [
          {
            "expr": "rate(kong_http_requests_total[5m])",
            "legendFormat": "{{service}}"
          }
        ]
      },
      {
        "title": "Average Response Time (P95)",
        "type": "gauge",
        "gridPos": { "x": 12, "y": 4, "w": 6, "h": 8 },
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(kong_latency_bucket[5m]))"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ms",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "value": 0, "color": "green" },
                { "value": 100, "color": "yellow" },
                { "value": 500, "color": "red" }
              ]
            }
          }
        }
      },
      {
        "title": "Success Rate",
        "type": "gauge",
        "gridPos": { "x": 18, "y": 4, "w": 6, "h": 8 },
        "targets": [
          {
            "expr": "sum(rate(kong_http_requests_total{code=~\"2..\"}[5m])) / sum(rate(kong_http_requests_total[5m])) * 100"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "value": 0, "color": "red" },
                { "value": 95, "color": "yellow" },
                { "value": 99, "color": "green" }
              ]
            }
          }
        }
      },
      {
        "title": "Requests by Endpoint",
        "type": "timeseries",
        "gridPos": { "x": 0, "y": 12, "w": 16, "h": 8 },
        "targets": [
          {
            "expr": "rate(kong_http_requests_total[5m])",
            "legendFormat": "{{route}}"
          }
        ]
      },
      {
        "title": "Error Rate",
        "type": "timeseries",
        "gridPos": { "x": 16, "y": 12, "w": 8, "h": 8 },
        "targets": [
          {
            "expr": "rate(kong_http_requests_total{code=~\"4..\"}[5m])",
            "legendFormat": "4xx (Client Errors)"
          },
          {
            "expr": "rate(kong_http_requests_total{code=~\"5..\"}[5m])",
            "legendFormat": "5xx (Server Errors)"
          }
        ]
      },
      {
        "title": "Relay Node Health",
        "type": "stat",
        "gridPos": { "x": 0, "y": 20, "w": 12, "h": 6 },
        "targets": [
          {
            "expr": "cardano_node_metrics_blockNum_int{instance=\"192.168.160.11\"}",
            "legendFormat": "Relay 1 Block Height"
          },
          {
            "expr": "cardano_node_metrics_blockNum_int{instance=\"192.168.160.12\"}",
            "legendFormat": "Relay 2 Block Height"
          }
        ]
      },
      {
        "title": "DB-Sync Status",
        "type": "stat",
        "gridPos": { "x": 12, "y": 20, "w": 12, "h": 6 },
        "targets": [
          {
            "expr": "cardano_node_metrics_blockNum_int - dbsync_block_height",
            "legendFormat": "Blocks Behind"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "value": 0, "color": "green" },
                { "value": 10, "color": "yellow" },
                { "value": 100, "color": "red" }
              ]
            }
          }
        }
      },
      {
        "title": "GraphQL & Hasura",
        "type": "row",
        "gridPos": { "x": 0, "y": 26, "w": 24, "h": 1 },
        "collapsed": false
      },
      {
        "title": "Hasura Health Status",
        "type": "stat",
        "gridPos": { "x": 0, "y": 27, "w": 8, "h": 4 },
        "targets": [
          {
            "expr": "up{job=\"hasura-mainnet\"}",
            "legendFormat": "Hasura Mainnet"
          },
          {
            "expr": "up{job=\"hasura-preprod\"}",
            "legendFormat": "Hasura Preprod"
          }
        ],
        "options": {
          "graphMode": "none",
          "colorMode": "background"
        },
        "fieldConfig": {
          "defaults": {
            "mappings": [
              { "options": { "0": { "text": "DOWN", "color": "red" } } },
              { "options": { "1": { "text": "UP", "color": "green" } } }
            ]
          }
        }
      },
      {
        "title": "GraphQL Requests/sec",
        "type": "timeseries",
        "gridPos": { "x": 8, "y": 27, "w": 8, "h": 8 },
        "targets": [
          {
            "expr": "rate(kong_http_requests_total{service=~\"graphql.*\"}[5m])",
            "legendFormat": "{{service}} - {{route}}"
          }
        ]
      },
      {
        "title": "GraphQL P95 Latency",
        "type": "gauge",
        "gridPos": { "x": 16, "y": 27, "w": 8, "h": 4 },
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(kong_latency_bucket{service=~\"graphql.*\"}[5m]))"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ms",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "value": 0, "color": "green" },
                { "value": 200, "color": "yellow" },
                { "value": 1000, "color": "red" }
              ]
            }
          }
        }
      },
      {
        "title": "GraphQL Error Rate",
        "type": "timeseries",
        "gridPos": { "x": 16, "y": 31, "w": 8, "h": 4 },
        "targets": [
          {
            "expr": "rate(kong_http_requests_total{service=~\"graphql.*\",code=~\"4..\"}[5m])",
            "legendFormat": "4xx Errors"
          },
          {
            "expr": "rate(kong_http_requests_total{service=~\"graphql.*\",code=~\"5..\"}[5m])",
            "legendFormat": "5xx Errors"
          }
        ]
      },
      {
        "title": "GraphQL by Network",
        "type": "piechart",
        "gridPos": { "x": 0, "y": 31, "w": 8, "h": 8 },
        "targets": [
          {
            "expr": "sum(increase(kong_http_requests_total{service=\"graphql-service\"}[24h]))",
            "legendFormat": "Mainnet"
          },
          {
            "expr": "sum(increase(kong_http_requests_total{service=\"graphql-preprod-service\"}[24h]))",
            "legendFormat": "Preprod"
          }
        ]
      },
      {
        "title": "Hasura Active Connections",
        "type": "stat",
        "gridPos": { "x": 0, "y": 39, "w": 12, "h": 4 },
        "targets": [
          {
            "expr": "hasura_postgres_connections{instance=\"192.168.170.20:8081\"}",
            "legendFormat": "Mainnet DB Connections"
          },
          {
            "expr": "hasura_postgres_connections{instance=\"192.168.170.20:8082\"}",
            "legendFormat": "Preprod DB Connections"
          }
        ]
      },
      {
        "title": "GraphQL vs Ogmios Usage",
        "type": "timeseries",
        "gridPos": { "x": 12, "y": 39, "w": 12, "h": 4 },
        "targets": [
          {
            "expr": "sum(rate(kong_http_requests_total{service=~\"graphql.*\"}[5m]))",
            "legendFormat": "GraphQL"
          },
          {
            "expr": "sum(rate(kong_http_requests_total{service=~\"ogmios.*\"}[5m]))",
            "legendFormat": "Ogmios"
          }
        ]
      }
    ]
  }
}






