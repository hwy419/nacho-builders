---
# Cardano Stake Pool Inventory
# nacho.builders

all:
  children:
    cardano:
      children:
        cardano_bp:
          hosts:
            cardano-bp:
              ansible_host: 192.168.160.10
              cardano_node_type: producer
              cardano_node_port: 6000
        
        cardano_relays:
          hosts:
            cardano-relay1:
              ansible_host: 192.168.160.11
              cardano_node_type: relay
              cardano_node_port: 6000
              cardano_public_port: 6001
              cardano_public_dns: nacho.builders
            
            cardano-relay2:
              ansible_host: 192.168.160.12
              cardano_node_type: relay
              cardano_node_port: 6000
              cardano_public_port: 6002
              cardano_public_dns: nacho.builders

        # Preprod Testnet (VLAN 161) - API service only, no block producer needed
        cardano_preprod:
          hosts:
            cardano-preprod-relay1:
              ansible_host: 192.168.161.11
              cardano_node_type: relay
              cardano_node_port: 6000
              cardano_network: preprod

        # Combined group for all relays (mainnet + preprod) - used by Ogmios playbook
        all_relays:
          children:
            cardano_relays:
            cardano_preprod:

      vars:
        ansible_user: michael
        ansible_become: true
        ansible_python_interpreter: /usr/bin/python3
        
        # Cardano Network
        cardano_network: mainnet
        # cardano_network: preprod  # Uncomment for testnet
        
        # Guild Operators paths
        cnode_home: /opt/cardano/cnode
        cardano_config_dir: "{{ cnode_home }}/files"
        cardano_db_dir: "{{ cnode_home }}/db"
        cardano_socket_path: "{{ cnode_home }}/sockets/node.socket"

    # Monitoring Infrastructure (VLAN 160)
    # Dedicated LXC container for Prometheus + Grafana
    # Access: http://192.168.160.2:3000 (Grafana)
    #         http://192.168.160.2:9090 (Prometheus)
    monitoring:
      hosts:
        cardano-monitor:
          ansible_host: 192.168.160.2
      vars:
        ansible_user: michael
        ansible_become: true
        ansible_python_interpreter: /usr/bin/python3

    # API Platform Infrastructure (VLAN 170)
    # Cardano API as a Service
    api_platform:
      hosts:
        cardano-gateway:
          ansible_host: 192.168.170.10
          vm_id: 120
          services:
            - kong
            - haproxy
            - nextjs
            - postgresql
        cardano-dbsync:
          ansible_host: 192.168.170.20
          vm_id: 121
          services:
            - postgresql
            - db-sync
            - graphql
      vars:
        ansible_user: michael
        ansible_become: true
        ansible_python_interpreter: /usr/bin/python3
    # Network Infrastructure (VLAN 150)
    # Dedicated pfSense server with 10Gb SFP link to Proxmox
    network:
      hosts:
        pfsense-gw:
          ansible_host: 192.168.150.1
          ansible_user: admin
          ansible_connection: ssh
          ansible_python_interpreter: /usr/local/bin/python3.11
          ansible_become: false
          ansible_ssh_private_key_file: ~/.ssh/cardano-spo
          hardware: dedicated_server
          interfaces:
            wan: igb0
            lan: igb1
            proxmox_trunk: bxe0  # 10Gb SFP
          services:
            - firewall
            - dhcp
            - dns
            - wireguard
      vars:
        ansible_ssh_common_args: '-o StrictHostKeyChecking=no'